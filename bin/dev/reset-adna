#!/bin/bash

script_dir=$(cd "$( dirname "${BASH_SOURCE[0]}")" && pwd )
source $script_dir/common

# bin/dev/reset-clearinghouse

g_source_db="sead_staging_development_clearinghouse"
g_target_db="sead_staging_development_adna"

copy-database --source $g_source_db --target $g_target_db --port $g_port --force --host $g_host

g_import_system_folder=$HOME/source/sead_clearinghouse_import/

pushd $g_import_system_folder

export PYTHONPATH="$g_import_system_folder:$PYTHONPATH"

poetry run python importer/scripts/import_excel.py ./config.yml data/input/SEAD_aDNA_data_20241114_RM.xlsx --no-timestamp --register --explode \
    --data-types adna --transfer-format csv --output-folder ./data/output/

popd

g_submission_id=1
g_issue_id=342
g_datatype=adna

# function generate_cr_name() {
#     local day=$(date +%Y%m%d)
#     local zid=`printf "%03d" ${g_submission_id}`
#     local dt_y=$g_datatype
#     local cr_x="$(date +%Y%m%d)_DML_SUBMISSION_${g_datatype^^}_${zid}_COMMIT"
#     echo "${cr_x^^}"
# }

bin/commit-submission \
    --mode update \
    --change 20250108_DML_SUBMISSION_ADNA_001_COMMIT \
    --id $g_submission_id  \
    --port 5433 \
    --database $g_target_db \
    --project adna
